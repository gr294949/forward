#!name=Apple天气增强
#!desc=解锁Apple天气的全部功能、替换空气质量数据源、添加下一小时降水数据、添加天气数据。
#!openUrl=https://itunes.apple.com/app/id1069513131
#!author=VirgilClyne[https://github.com/VirgilClyne], WordlessEcho[https://github.com/WordlessEcho], 001[https://github.com/001ProMax]
#!tag=功能增强
#!system=iOS, iPadOS, macOS, watchOS
#!system_version=18
#!loon_version=3.2.4(787)
#!homepage=https://hub.kelee.one
#!icon=https://raw.githubusercontent.com/luestr/IconResource/main/App_icon/120px/AppleWeather.png
#!date=2026-02-25 19:48:36

[Argument]
Weather.Provider=select, "ColorfulClouds", "WeatherKit", "QWeather", tag=[天气]数据源, desc=使用选定的数据源替换天气数据。
NextHour.Provider=select, "ColorfulClouds", "WeatherKit", "QWeather", tag=[未来一小时降水强度]数据源, desc=使用选定的数据源填充未来一小时降水强度的数据。
AirQuality.Calculate.Algorithm=select, "EU_EAQI", "None", "UBA", "WAQI_InstantCast_US", "WAQI_InstantCast_CN", "WAQI_InstantCast_CN_25_DRAFT", tag=AQI算法, desc=使用内置算法，通过污染物数据本地计算空气指数。InstantCast源自于WAQI，美标版本使用了WAQI的臭氧标准。
API.ColorfulClouds.Token=input, "", tag=[API]彩云天气令牌, desc=彩云天气API令牌
API.QWeather.Host=input, "devapi.qweather.com", tag=[API]和风天气主机, desc=和风天气API使用的主机名
API.QWeather.Token=input, "", tag=[API]和风天气令牌, desc=和风天气API令牌
API.WAQI.Token=input, "", tag=[API]WAQI令牌, desc=WAQI API令牌，填写此字段将自动使用WAQI高级API
Storage=select, "Argument", "PersistentStore", "database", tag=[储存]配置类型, desc=选择要使用的配置类型。未设置此选项或不通过此选项的旧版本的配置顺序依旧是$persistentStore (BoxJs) > $argument > database。
LogLevel=select, "WARN", "OFF", "ERROR", "INFO", "DEBUG", "ALL", tag=[调试]日志等级, desc=选择脚本日志的输出等级，低于所选等级的日志将全部输出。

[Rule]
DOMAIN, weather-analytics-events.apple.com, REJECT-DROP
DOMAIN, tether.edge.apple, REJECT-DROP
DOMAIN-SUFFIX, tthr.apple.com, REJECT-DROP
AND, ((IP-ASN, 714, no-resolve), (PROTOCOL, QUIC)), REJECT-DROP

[Script]
http-response ^https?:\/\/weatherkit\.apple\.com\/api\/v1\/availability\/ requires-body=true, script-path=https://github.com/NSRingo/WeatherKit/releases/download/v3.0.9/response.bundle.js, tag=天气可用性响应, argument=[{Weather.Provider},{NextHour.Provider},{AirQuality.Calculate.Algorithm},{API.ColorfulClouds.Token},{API.QWeather.Host},{API.QWeather.Token},{API.WAQI.Token},{Storage},{LogLevel}]

http-response ^https?:\/\/weatherkit\.apple\.com\/api\/v2\/weather\/ requires-body=true, binary-body-mode=true, script-path=https://github.com/NSRingo/WeatherKit/releases/download/v3.0.9/response.bundle.js, tag=天气响应, argument=[{Weather.Provider},{NextHour.Provider},{AirQuality.Calculate.Algorithm},{API.ColorfulClouds.Token},{API.QWeather.Host},{API.QWeather.Token},{API.WAQI.Token},{Storage},{LogLevel}]

[MitM]
hostname=weatherkit.apple.com